# TimerApp 故障排除指南

## 🚨 常见问题快速解决

### 问题1：应用无法启动

**症状**: 双击应用无反应，或提示"无法打开"

**解决方案**:

#### 方法一：右键打开（推荐）
1. 右键点击 `TimerApp.app`
2. 选择 **"打开"**
3. 在安全提示中选择 **"打开"**

#### 方法二：终端启动
```bash
cd /Users/wqz/Documents/work/tools/timer
open TimerApp.app
```

#### 方法三：修复应用包
```bash
cd /Users/wqz/Documents/work/tools/timer
./fix-app-bundle.sh
```

#### 方法四：检查系统安全设置
1. 打开 **系统偏好设置** → **安全性与隐私** → **通用**
2. 查看是否有关于TimerApp的提示
3. 点击 **"仍要打开"**

### 问题2：菜单栏不显示图标

**症状**: 应用启动后菜单栏没有时钟图标

**解决方案**:

#### 检查应用是否在运行
```bash
# 检查进程
ps aux | grep TimerApp

# 如果进程存在但无图标，重启应用
pkill -f TimerApp
open TimerApp.app
```

#### 检查菜单栏空间
1. 菜单栏可能已满，尝试移除其他图标
2. 重启菜单栏服务
```bash
# 重启菜单栏
killall SystemUIServer
```

#### 重新构建应用
```bash
cd /Users/wqz/Documents/work/tools/timer
./build-complete-app.sh
```

### 问题3：定时结束没有声音

**症状**: 定时结束时没有播放提醒音效

**解决方案**:

#### 检查系统音量
1. 确保系统音量未静音
2. 检查应用音量设置

#### 测试音效文件
1. 打开控制界面
2. 点击"选择音效"
3. 选择一个已知可用的音频文件测试
4. 或点击"重置"使用默认音效

#### 检查音频格式支持
- 支持格式：MP3、WAV、AIFF、M4A
- 确保音频文件未损坏

### 问题4：菜单栏时间显示不更新

**症状**: 菜单栏显示的时间不随计时更新

**解决方案**:

#### 重启应用
```bash
pkill -f TimerApp
open TimerApp.app
```

#### 检查系统权限
1. 打开 **系统偏好设置** → **安全性与隐私** → **辅助功能**
2. 确保TimerApp有权限控制电脑

#### 重建应用包
```bash
cd /Users/wqz/Documents/work/tools/timer
./create-proper-app.sh
```

## 🔧 高级故障排除

### 应用包完整性检查

#### 检查应用包结构
```bash
cd /Users/wqz/Documents/work/tools/timer

# 检查基本结构
ls -la TimerApp.app/Contents/
ls -la TimerApp.app/Contents/MacOS/

# 检查可执行文件
file TimerApp.app/Contents/MacOS/TimerApp

# 检查权限
ls -la TimerApp.app/Contents/MacOS/TimerApp
```

**预期输出**:
```
TimerApp.app/Contents/MacOS/TimerApp: Mach-O 64-bit executable arm64
-rwxr-xr-x  1 user  staff  475640 Feb 26 16:00 TimerApp
```

#### 验证Info.plist配置
```bash
# 检查配置文件
cat TimerApp.app/Contents/Info.plist

# 验证关键配置项
plutil -p TimerApp.app/Contents/Info.plist | grep -E "(CFBundle|LS)"
```

### 日志和调试信息

#### 启用调试模式
```bash
# 通过终端运行查看输出
/Users/wqz/Documents/work/tools/timer/TimerApp.app/Contents/MacOS/TimerApp
```

#### 查看系统日志
```bash
# 查看应用相关日志
log show --predicate 'process == "TimerApp"' --last 1h

# 或使用Console应用查看实时日志
```

### 环境兼容性检查

#### 检查系统版本
```bash
# 查看macOS版本
sw_vers

# 检查Swift版本
swift --version
```

**最低要求**:
- macOS 12.0+
- Swift 5.7+

#### 检查架构兼容性
```bash
# 检查应用架构
file TimerApp.app/Contents/MacOS/TimerApp

# 检查系统架构
uname -m
```

## 🛠️ 修复工具使用指南

### fix-app-bundle.sh 使用

**功能**: 修复应用包权限和属性问题

```bash
cd /Users/wqz/Documents/work/tools/timer

# 运行修复脚本
./fix-app-bundle.sh

# 脚本将执行以下操作：
# 1. 检查应用包结构
# 2. 修复文件权限
# 3. 设置应用包属性
# 4. 测试应用启动
```

### build-complete-app.sh 使用

**功能**: 完整重建应用包

```bash
cd /Users/wqz/Documents/work/tools/timer

# 运行构建脚本
./build-complete-app.sh

# 脚本将执行以下操作：
# 1. 清理旧版本
# 2. 编译源代码
# 3. 创建应用包
# 4. 设置权限和属性
```

### create-proper-app.sh 使用

**功能**: 创建标准的双击启动应用

```bash
cd /Users/wqz/Documents/work/tools/timer

# 运行创建脚本
./create-proper-app.sh

# 专门解决双击启动问题
# 创建符合macOS标准的应用包
```

## 📋 问题诊断流程

### 启动问题诊断流程
```
双击无法启动？
    ↓
尝试右键打开
    ↓
检查系统安全设置
    ↓
运行修复脚本
    ↓
重新构建应用
    ↓
检查系统日志
```

### 功能问题诊断流程
```
功能异常？
    ↓
重启应用测试
    ↓
检查相关权限
    ↓
测试简化场景
    ↓
查看调试信息
    ↓
重建应用包
```

## 🔄 重置和恢复

### 完全重置应用
```bash
# 停止应用
pkill -f TimerApp

# 删除应用包
rm -rf TimerApp.app

# 重新构建
./build-complete-app.sh

# 重新启动
open TimerApp.app
```

### 重置用户设置
应用设置通常保存在以下位置：
```bash
# 查看可能的设置文件
ls -la ~/Library/Preferences/ | grep -i timer
ls -la ~/Library/Application\ Support/ | grep -i timer
```

## 📞 技术支持

### 自助解决步骤
1. **阅读文档**: 查看README.md和使用说明.md
2. **运行修复脚本**: 使用提供的自动化工具
3. **检查日志**: 查看系统日志获取详细信息
4. **简化测试**: 测试基本功能是否正常

### 寻求帮助时需要的信息
如果问题无法解决，请提供以下信息：

```markdown
## 问题描述
[详细描述遇到的问题]

## 系统信息
- macOS版本: `sw_vers`
- Swift版本: `swift --version`
- 系统架构: `uname -m`

## 错误信息
[粘贴具体的错误信息或日志]

## 已尝试的解决方案
[列出已经尝试过的解决方法]
```

### 联系支持
- 查看项目文档和FAQ
- 提交Issue到项目仓库
- 提供详细的错误信息

## 🎯 预防措施

### 定期维护
- 定期检查应用更新
- 备份重要设置
- 清理临时文件

### 最佳实践
- 使用官方推荐的双击启动方式
- 避免直接运行可执行文件
- 定期重启应用保持稳定性
- 及时更新操作系统

---

**重要提示**: 大多数问题可以通过运行修复脚本解决。如果问题持续存在，请提供详细的错误信息以便进一步诊断。